-- Stored Procedure to Calculate Grades and GPA
DELIMITER //

CREATE PROCEDURE Calculate_Grades()
BEGIN 
	UPDATE results
    SET grades = (
		CASE 
			WHEN marks_obained >=90 THEN 'A+'	
            WHEN marks_obained >=80 THEN 'A'
            WHEN marks_obained >=70 THEN 'B+'
            WHEN marks_obained >=60 THEN 'B'
			WHEN marks_obained >=50 THEN 'C'
			WHEN marks_obained >=40 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    'D'
			ELSE 'F'
		END
	);
END //

DELIMITER ;

SHOW CREATE PROCEDURE Calculate_Grades;




-- GPA Logic using CASE
CREATE VIEW GPA_View AS
SELECT 
    Student_id,
    ROUND(AVG(
        CASE grade
            WHEN 'A+' THEN 10
            WHEN 'A' THEN 9
            WHEN 'B+' THEN 8
            WHEN 'B' THEN 7
            WHEN 'C' THEN 6
            WHEN 'D' THEN 5
            ELSE 0
        END
    ), 2) AS GPA
FROM Results
GROUP BY Student_id;

SELECT * FROM GPA_View;




DROP VIEW gpa_view;

--  Create result_summary View 
CREATE VIEW result_summary AS
SELECT 
    s.Stud_ID,
    s.name,
    ROUND(AVG(
        CASE r.grade
            WHEN 'A+' THEN 10
            WHEN 'A' THEN 9
            WHEN 'B+' THEN 8
            WHEN 'B' THEN 7
            WHEN 'C' THEN 6
            WHEN 'D' THEN 5
            ELSE 0
        END
    ), 2) AS GPA
FROM Students s
JOIN Results r ON s.Stud_ID = r.Student_id
GROUP BY s.Stud_ID, s.name;
SELECT * FROM result_summary;



DROP VIEW result_summary;


